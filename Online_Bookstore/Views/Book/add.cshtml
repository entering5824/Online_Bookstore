@model Online_Bookstore.Models.Book
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.Title = "Add Book";
    var categories = ViewBag.Categories as List<Online_Bookstore.Models.BookCategory>;
}

<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow-lg">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">
                        <i class="fas fa-plus me-2"></i>Add New Book
                    </h4>
                </div>
                <div class="card-body padding-medium">
                    @using (Html.BeginForm("AddBook", "Book", FormMethod.Post, new { @class = "needs-validation", novalidate = "novalidate" }))
                    {
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="BookCode" class="form-label">Book Code</label>
                                <input type="text" name="BookCode" id="BookCode" class="form-control" required />
                                <div class="invalid-feedback">Please enter a book code.</div>
                                <small class="form-text text-muted">Enter a unique identifier for the book (e.g., BOOK001)</small>
                            </div>
                            
                            <div class="col-md-6">
                                <label for="Title" class="form-label">Title</label>
                                <input type="text" name="Title" id="Title" class="form-control" required />
                                <div class="invalid-feedback">Please enter the book title.</div>
                            </div>
                            
                            <div class="col-md-6">
                                <label for="Author" class="form-label">Author</label>
                                <input type="text" name="Author" id="Author" class="form-control" required />
                                <div class="invalid-feedback">Please enter the author name.</div>
                            </div>
                            
                            <div class="col-md-6">
                                <label for="ISBN" class="form-label">ISBN</label>
                                <input type="text" name="ISBN" id="ISBN" class="form-control" />
                            </div>
                            
                            <div class="col-md-6">
                                <label for="PublicationYear" class="form-label">Publication Year</label>
                                <input type="number" name="PublicationYear" id="PublicationYear" class="form-control" min="1000" max="@DateTime.Now.Year" />
                            </div>
                            
                            <div class="col-md-6">
                                <label for="Publisher" class="form-label">Publisher</label>
                                <input type="text" name="Publisher" id="Publisher" class="form-control" />
                            </div>
                            
                            <div class="col-md-6">
                                <label for="Language" class="form-label">Language</label>
                                <input type="text" name="Language" id="Language" class="form-control" />
                            </div>
                            
                            <div class="col-md-6">
                                <label for="CategoryId" class="form-label">Category</label>
                                <select name="CategoryId" id="CategoryId" class="form-control" required>
                                    <option value="">Select a category</option>
                                    @if (categories != null)
                                    {
                                        foreach (var category in categories)
                                        {
                                            <option value="@category.CategoryId">@category.CategoryName</option>
                                        }
                                    }
                                </select>
                                <div class="invalid-feedback">Please select a category.</div>
                            </div>
                            
                            <div class="col-md-6">
                                <label for="TotalCopies" class="form-label">Total Copies</label>
                                <input type="number" name="TotalCopies" id="TotalCopies" class="form-control" required min="1" />
                                <div class="invalid-feedback">Please enter the total number of copies.</div>
                            </div>
                            
                            <div class="col-md-6">
                                <label for="AvailableCopies" class="form-label">Available Copies</label>
                                <input type="number" name="AvailableCopies" id="AvailableCopies" class="form-control" required min="0" />
                                <div class="invalid-feedback">Please enter the number of available copies.</div>
                            </div>
                            
                            <div class="col-12">
                                <label for="Description" class="form-label">Description</label>
                                <textarea name="Description" id="Description" class="form-control" rows="4" placeholder="Enter book description..."></textarea>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-between mt-4">
                            <a href="@Url.Action("ListBooks", "Book")" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left me-2"></i>Back to List
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-2"></i>Save Book
                            </button>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Bootstrap form validation
    (function() {
        'use strict';
        window.addEventListener('load', function() {
            var forms = document.getElementsByClassName('needs-validation');
            var validation = Array.prototype.filter.call(forms, function(form) {
                form.addEventListener('submit', function(event) {
                    if (form.checkValidity() === false) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    form.classList.add('was-validated');
                }, false);
            });
        }, false);
    })();
    
    // Auto-sync available copies with total copies
    document.getElementById('TotalCopies').addEventListener('input', function() {
        const totalCopies = parseInt(this.value) || 0;
        const availableCopies = document.getElementById('AvailableCopies');
        if (availableCopies.value === '' || parseInt(availableCopies.value) > totalCopies) {
            availableCopies.value = totalCopies;
        }
        availableCopies.max = totalCopies;
    });
</script>
