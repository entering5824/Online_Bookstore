@{
    Layout = "_Layout"; // Dùng layout chung
    var error = ViewBag.Error;
    var totalBooks = ViewBag.TotalBooks;
    var totalUsers = ViewBag.TotalUsers;
    var totalBorrowRecords = ViewBag.TotalBorrowRecords;
    var totalReservations = ViewBag.TotalReservations;
    var topBorrowedBooks = ViewBag.TopBorrowedBooks as List<Tuple<string, int>>;
    var topReservedBooks = ViewBag.TopReservedBooks as List<Tuple<string, int>>;
    var currentUser = ViewBag.CurrentUser; // giả sử object có FullName và Role
}

<div class="container mt-4">
    <div class="row">
        <div class="col-md-12">
            <div class="jumbotron">
                <h1 class="display-4">Chào mừng đến với Thư viện trực tuyến!</h1>
                <p class="lead">Khám phá kho tàng sách và tài nguyên số phong phú của chúng tôi.</p>
                <hr class="my-4">

                @if (!string.IsNullOrEmpty(error))
                {
                    <div class="alert alert-warning" role="alert">
                        <i class="fas fa-exclamation-triangle"></i> @error
                    </div>
                }

                @if (currentUser == null)
                {
                    <p>Bạn chưa đăng nhập. Vui lòng đăng nhập để sử dụng đầy đủ tính năng.</p>
                    <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#loginModal">
                        Đăng nhập
                    </button>
                    <button type="button" class="btn btn-success btn-lg ml-2" data-toggle="modal" data-target="#registerModal">
                        Đăng ký
                    </button>
                }
            </div>
        </div>
    </div>

    <!-- Thống kê tổng quan -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card bg-primary text-white">
                <div class="card-body text-center">
                    <h5 class="card-title">📚 Tổng số sách</h5>
                    <h2 class="card-text">@totalBooks</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-success text-white">
                <div class="card-body text-center">
                    <h5 class="card-title">👥 Tổng số người dùng</h5>
                    <h2 class="card-text">@totalUsers</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-warning text-white">
                <div class="card-body text-center">
                    <h5 class="card-title">📖 Tổng phiếu mượn</h5>
                    <h2 class="card-text">@totalBorrowRecords</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-info text-white">
                <div class="card-body text-center">
                    <h5 class="card-title">📋 Tổng đặt sách</h5>
                    <h2 class="card-text">@totalReservations</h2>
                </div>
            </div>
        </div>
    </div>

    <!-- Menu chính -->
    <div class="row mt-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">📚 Sách</h5>
                    <p class="card-text">Khám phá kho sách phong phú với nhiều thể loại khác nhau.</p>
                    <a asp-controller="Books" asp-action="Index" class="btn btn-primary">Xem sách</a>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">💻 Tài nguyên số</h5>
                    <p class="card-text">Truy cập các tài nguyên số, tài liệu điện tử.</p>
                    <a asp-controller="DigitalResources" asp-action="Index" class="btn btn-primary">Xem tài nguyên</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Top sách mượn nhiều nhất -->
    <div class="row mt-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5>🏆 Top 10 sách được mượn nhiều nhất</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Tên sách</th>
                                    <th>Số lần mượn</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (topBorrowedBooks != null)
                                {
                                    var idx = 1;
                                    foreach (var book in topBorrowedBooks)
                                    {
                                        <tr>
                                            <td>@idx</td>
                                            <td>@book.Item1</td>
                                            <td><span class="badge badge-primary">@book.Item2</span></td>
                                        </tr>
                                        idx++;
                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Top sách đặt nhiều nhất -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5>🏆 Top 10 sách được đặt nhiều nhất</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Tên sách</th>
                                    <th>Số lần đặt</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (topReservedBooks != null)
                                {
                                    var idx2 = 1;
                                    foreach (var book in topReservedBooks)
                                    {
                                        <tr>
                                            <td>@idx2</td>
                                            <td>@book.Item1</td>
                                            <td><span class="badge badge-success">@book.Item2</span></td>
                                        </tr>
                                        idx2++;
                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    @if (currentUser != null)
    {
        <div class="row mt-4">
            <div class="col-md-12">
                <div class="alert alert-info">
                    <h4>Chào mừng, @currentUser.FullName!</h4>
                    <p>Bạn đã đăng nhập với vai trò: <strong>@currentUser.Role</strong></p>
                </div>
            </div>
        </div>
    }
</div>
